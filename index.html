<!doctype html>
<html lang="de" data-theme="classic">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ABCâ€‘Abenteuer â€“ HÃ¶r & Finde (Prototyp)</title>

  <!-- PWA Manifest & Theme -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/svg+xml" href="icon.svg">
  <meta name="theme-color" content="#5a6ff0">

  <!-- JSZip fÃ¼r Export/Import -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://unpkg.com/lottie-web/build/player/lottie.min.js"></script>

  <script>
    (function(){
      try{
        const storedTheme = localStorage.getItem('abc-abenteuer-theme');
        if(storedTheme){
          document.documentElement.setAttribute('data-theme', storedTheme);
        }
      }catch(err){/* ignore storage errors */}
    })();
  </script>

  <link rel="stylesheet" href="app/style.css">

</head>
<body>
  <header>
    <h1>ABCâ€‘Abenteuer Â· HÃ¶r &amp; Finde</h1>
    <span class="badge">Prototyp</span>
    <div class="header-actions">
      <button id="installBtn" class="install-btn">ğŸ“± Installieren</button>
      <div class="theme-switcher" id="themeSwitcher">
        <button type="button" class="theme-switcher__trigger" id="themeSwitcherBtn" aria-haspopup="true" aria-expanded="false">
          <span class="theme-switcher__icon" aria-hidden="true">ğŸ¨</span>
          <span class="theme-switcher__label" id="currentThemeLabel">Sonnig</span>
          <svg class="theme-switcher__chevron" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
            <path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6" />
          </svg>
        </button>
        <div class="theme-switcher__menu hidden" id="themeSwitcherMenu" role="menu" aria-label="Theme auswÃ¤hlen">
          <button type="button" class="theme-option" data-theme-option="classic" role="menuitemradio" aria-checked="true">
            <span>ğŸŒˆ Sonnig</span>
            <small>Helles Standard-Theme</small>
          </button>
          <button type="button" class="theme-option" data-theme-option="nebula" role="menuitemradio" aria-checked="false">
            <span>ğŸŒŒ Nachthimmel</span>
            <small>Kontrastreich fÃ¼r ruhige Abende</small>
          </button>
        </div>
      </div>
      <button id="settingsBtn" class="settings-btn" title="Einstellungen" aria-label="Einstellungen">
        <span class="settings-btn__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="presentation" focusable="false">
            <circle cx="12" cy="12" r="3.2" fill="none" stroke="currentColor" stroke-width="2"></circle>
            <path d="M19.4 12.94a7.82 7.82 0 0 0 .06-1 7.82 7.82 0 0 0-.06-1l1.72-1.34a.6.6 0 0 0 .14-.76l-1.63-2.82a.6.6 0 0 0-.74-.26l-2 .8a7.66 7.66 0 0 0-1.71-.99l-.3-2.1a.6.6 0 0 0-.6-.5h-3.26a.6.6 0 0 0-.6.5l-.3 2.1a7.66 7.66 0 0 0-1.71.99l-2-.8a.6.6 0 0 0-.74.26L2.68 8.84a.6.6 0 0 0 .14.76L4.54 11a7.82 7.82 0 0 0 0 2l-1.72 1.38a.6.6 0 0 0-.14.76l1.63 2.82a.6.6 0 0 0 .74.26l2-.8a7.66 7.66 0 0 0 1.71 1l.3 2.09a.6.6 0 0 0 .6.5h3.26a.6.6 0 0 0 .6-.5l.3-2.09a7.66 7.66 0 0 0 1.71-1l2 .8a.6.6 0 0 0 .74-.26l1.63-2.82a.6.6 0 0 0-.14-.76Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></path>
          </svg>
        </span>
      </button>
    </div>
  </header>

  <main>
    <nav class="tabs">
      <button class="active" data-tab="spiel">Spiel</button>
      <button data-tab="ueben">Ãœben</button>
      <button data-tab="album">ğŸ Mein Album</button>
      <button data-tab="eltern">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ FÃ¼r Eltern</button>
    </nav>

    <!-- SPIEL -->
    <section id="spiel" class="card">
      <div id="setup">
        <!-- Info-Box bei fehlenden Aufnahmen -->
        <div id="emptyState" class="info-box hidden">
          <h3>ğŸ™ï¸ Noch keine Aufnahmen vorhanden</h3>
          <p>Um das Spiel zu starten, musst du zuerst deine Stimme fÃ¼r mindestens einen Buchstaben aufnehmen.</p>
          <button id="goToSettings" class="btn">Jetzt Aufnahmen machen</button>
        </div>

        <p class="muted">WÃ¤hle das Set, die Rundenzahl und starte. Das Spiel nutzt nur Buchstaben, fÃ¼r die <b>bereits Aufnahmen</b> vorhanden sind.</p>

        <div id="lernwegTrack" class="lernweg-track hidden" role="group" aria-label="Lernweg-Fortschritt">
          <div class="lernweg-head">
            <span>Lernweg-Fortschritt</span>
            <span id="lernwegDetail" class="detail"></span>
          </div>
          <div class="lernweg-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
            <span id="lernwegFill"></span>
          </div>
          <div id="lernwegNext" class="lernweg-foot muted"></div>
        </div>

        <div style="margin:16px 0">
          <label style="font-weight:800; display:block; margin-bottom:8px">ğŸ¤ Welche Aufnahmen?</label>
          <select id="setSelector" class="btn secondary" style="width:100%; max-width:300px; text-align:left; font-size:16px; padding:12px">
            <option value="">Lade...</option>
          </select>
        </div>

        <div class="controls" style="margin:10px 0 6px">
          <label>Runden:
            <input id="rounds" type="range" min="5" max="26" value="10" step="1" style="vertical-align:middle">
            <b><span id="roundsOut">10</span></b>
          </label>
          <button id="btnStart" class="btn">Spiel starten</button>
          <button id="btnChangeMode" class="btn secondary" type="button">Modus wechseln</button>
        </div>
        <p id="modeHint" class="muted hidden" style="margin-top:-6px"></p>
      </div>

      <div id="hud" class="hud hidden">
        <div class="score">
          <span>Runde <b id="roundNow">1</b>/<b id="roundMax">10</b></span>
          <span class="ok">Richtig: <b id="okCount">0</b></span>
          <span class="bad">Falsch: <b id="badCount">0</b></span>
        </div>
        <div class="progress"><i id="bar"></i></div>
        <div class="in-game-controls" style="margin-top:10px; display:flex; gap:12px; align-items:center;">
          <button id="btnTestAudio" class="btn secondary" title="Aktuellen Buchstaben nochmals anhÃ¶ren" disabled>ğŸ”Š Nochmal anhÃ¶ren</button>
          <div style="margin-left:auto; display:flex; gap:12px; align-items:center; flex-wrap:wrap; justify-content:flex-end;">
            <label style="font-weight:600; font-size:13px; color:var(--muted)">Set:</label>
            <select id="inGameSetSelector" class="btn secondary" style="padding: 8px 12px; font-size:14px; min-width:160px;">
              <option value="">Lade...</option>
            </select>
            <label style="font-weight:600; font-size:13px; color:var(--muted)">Audio:</label>
            <select id="inGameDifficulty" class="btn secondary" style="padding: 8px 12px; font-size:14px;">
              <option value="LEICHT">Leicht</option>
              <option value="MITTEL">Mittel</option>
              <option value="SCHWER">Schwer</option>
              <option value="AFFIG">Affig</option>
            </select>
            <button id="btnEndGame" class="btn danger" title="Spiel beenden" style="padding: 8px 12px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="color: white; vertical-align: middle;">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <div id="letters" class="grid-letters" aria-label="Buchstaben-Auswahl"></div>
    </section>

    <!-- MEIN ALBUM -->
    <section id="album" class="card hidden">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px">
        <h2 style="margin:0">ğŸ Mein Sticker-Album</h2>
        <div style="font-weight:800; font-size:18px">â­ <span id="starCount">0</span> Sterne</div>
      </div>

      <div id="albumTabs" style="display:flex; gap:8px; margin-bottom:16px; overflow-x:auto"></div>
      <div id="albumContent"></div>

      <div style="margin-top:20px; text-align:center">
        <button id="btnOpenPack" class="btn" disabled>ğŸ Pack Ã¶ffnen (10 â­)</button>
      </div>
    </section>

    <!-- ÃœBEN -->
    <section id="ueben" class="card hidden">
      <h2>Ãœbungsmodus</h2>
      <p class="muted">WÃ¤hle eine Schwierigkeit und klicke auf einen Buchstaben, um die Aufnahme anzuhÃ¶ren.</p>
      <div class="controls" style="margin:10px 0 14px; display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
        <label style="font-weight:600; font-size:13px; color:var(--muted)">Aufnahmeset:</label>
        <select id="practiceSetSelector" class="btn secondary" style="padding: 8px 12px; font-size:14px; min-width:180px;">
          <option value="">Lade...</option>
        </select>
        <label style="font-weight:600; font-size:13px; color:var(--muted)">Schwierigkeit:</label>
        <select id="practiceDifficulty" class="btn secondary" style="padding: 8px 12px; font-size:14px;">
          <option value="LEICHT">Leicht</option>
          <option value="MITTEL">Mittel</option>
          <option value="SCHWER">Schwer</option>
          <option value="AFFIG">Affig</option>
        </select>
      </div>
      <div id="practiceLetters" class="grid-letters" aria-label="Buchstaben-Auswahl"></div>
    </section>

    <!-- ELTERN-BEREICH -->
    <section id="eltern" class="card hidden">
      <h2>Statistiken & Fortschritt</h2>
      <p class="muted">Hier sehen Sie bald eine Auswertung des Lernfortschritts.</p>
    </section>

    <!-- EINSTELLUNGEN -->
    <section id="einstellungen" class="card hidden">
      <!-- Set-Verwaltung -->
      <div style="margin-bottom:24px; padding-bottom:24px; border-bottom:2px solid #f3e8ff">
        <p><b>Aufnahme-Sets verwalten</b></p>
        <p class="muted">Erstelle verschiedene Aufnahme-Sets (z.B. "Mit WÃ¶rtern", "Nur Buchstaben", "Kinderstimme") und wechsle zwischen ihnen.</p>

        <div id="setsList" style="display:flex; gap:10px; flex-wrap:wrap; margin:16px 0"></div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; align-items:center">
          <button id="btnCreateSet" class="btn secondary">â• Neues Set erstellen</button>
          <div style="margin-left:auto; display:flex; gap:8px; align-items:center">
            <label style="font-weight:600; color:#6b7896">Standard-Set:</label>
            <select id="defaultSetSelector" class="btn secondary" style="min-width:200px; text-align:left; font-size:14px"></select>
          </div>
        </div>
      </div>

      <div class="settings-wrap">
        <div>
          <p><b>Einstellungen Â· Aufnahmen</b></p>
          <div id="progressBadge" class="progress-badge empty">0 von 26 Buchstaben aufgenommen</div>
          <p class="muted">Tippe einen Buchstaben an, um ihn aufzunehmen. Deine Aufnahmen werden <b>nur lokal</b> gespeichert.</p>
          <div id="statusGrid" class="status-grid" aria-label="Aufnahmestatus"></div>
          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; align-items:center">
            <button id="exportBtn" class="btn secondary">ğŸ“¦ Exportieren</button>
            <button id="importBtn" class="btn secondary">ğŸ“¥ Importieren</button>
            <input type="file" id="importFile" accept=".zip" style="display:none">
            <button id="clearAll" class="btn danger">Alle lÃ¶schen</button>
            <span class="muted">Mikrofon benÃ¶tigt https/localhost.</span>
          </div>
        </div>

        <aside class="recorder">
          <div style="display:flex; align-items:center; gap:12px; margin-bottom:8px">
            <div id="recLetter" class="rec-letter">A</div>
            <div>
              <h3 style="margin:.2rem 0">Aufnahme: <span id="recTitle">A</span></h3>
              <div class="muted">Status: <b id="recStatus">Keine Aufnahme</b></div>
            </div>
          </div>
          <div id="recordDifficultyGroup" class="chip-group" style="margin-bottom:8px; display:flex; gap:8px; flex-wrap:wrap">
            <button type="button" class="chip active" data-record-difficulty="LEICHT">Leicht</button>
            <button type="button" class="chip" data-record-difficulty="MITTEL">Mittel</button>
            <button type="button" class="chip" data-record-difficulty="SCHWER">Schwer</button>
            <button type="button" class="chip" data-record-difficulty="AFFIG">Affig</button>
          </div>
          <div class="controls" style="margin:10px 0">
            <button id="btnRec" class="btn">ğŸ™ï¸ Aufnehmen</button>
            <button id="btnPlay" class="btn secondary" disabled>â–¶ï¸ Testen</button>
            <button id="btnDelete" class="btn ghost" disabled>ğŸ—‘ï¸ LÃ¶schen</button>
            <span class="timer" id="timer">00:00</span>
          </div>
          <div id="clipList" class="clip-list" style="display:flex; flex-direction:column; gap:6px; margin-bottom:8px"></div>
          <div class="muted">Tipp: Spreche klar und kurz (z.â€¯B. â€Bâ€œ oder â€B â€“ wie Ballâ€œ).</div>
        </aside>
      </div>
  </section>
</main>

  <div id="unlockBanner" class="unlock-banner hidden" role="status" aria-live="polite">
    <span aria-hidden="true">ğŸ‰</span>
    <span>
      <strong>NÃ¤chste Stufe freigeschaltet!</strong>
      <span id="unlockBannerText">Weiter geht's!</span>
    </span>
  </div>

  <!-- Overlays: Regenbogen / Monster -->
  <div id="overlayGood" class="overlay hidden" role="alert" aria-live="assertive">
    <div class="panel rainbow tada">
      <!-- Regenbogen SVG -->
      <svg viewBox="0 0 600 320" width="320" height="170" aria-hidden="true">
        <path d="M60,280 A240,240 0 0 1 540,280" stroke="#ff3b30" stroke-width="26" fill="none" pathLength="1"></path>
        <path d="M90,280 A210,210 0 0 1 510,280" stroke="#ff9500" stroke-width="26" fill="none" pathLength="1"></path>
        <path d="M120,280 A180,180 0 0 1 480,280" stroke="#ffcc00" stroke-width="26" fill="none" pathLength="1"></path>
        <path d="M150,280 A150,150 0 0 1 450,280" stroke="#34c759" stroke-width="26" fill="none" pathLength="1"></path>
        <path d="M180,280 A120,120 0 0 1 420,280" stroke="#0bb1ff" stroke-width="26" fill="none" pathLength="1"></path>
        <path d="M210,280 A90,90 0 0 1 390,280" stroke="#af52de" stroke-width="26" fill="none" pathLength="1"></path>
      </svg>
      <div class="tag">Super! ğŸ‰</div>
    </div>
  </div>

  <div id="overlayBad" class="overlay hidden" role="alert" aria-live="assertive">
    <div class="panel monster">
      <!-- â€Generiertes" Monster als Inlineâ€‘SVG -->
      <svg viewBox="0 0 300 300" width="240" height="240" aria-label="Monster">
        <defs>
          <filter id="shadow"><feDropShadow dx="0" dy="3" stdDeviation="4" flood-color="#000" flood-opacity=".25"/></filter>
        </defs>
        <!-- KÃ¶rper -->
        <g class="wiggle" filter="url(#shadow)">
          <ellipse cx="150" cy="170" rx="100" ry="110" fill="#7b5cff"/>
          <!-- HÃ¶rner -->
          <path d="M85,85 L105,30 L125,85" fill="#ff8a00"/>
          <path d="M175,85 L195,30 L215,85" fill="#ff8a00"/>
          <!-- Augen -->
          <circle cx="115" cy="140" r="26" fill="#fff"/>
          <circle cx="185" cy="140" r="26" fill="#fff"/>
          <circle class="blink-eye" cx="115" cy="140" r="11" fill="#111"/>
          <circle class="blink-eye" cx="185" cy="140" r="11" fill="#111"/>
          <!-- Mund -->
          <rect x="105" y="190" width="90" height="30" rx="14" fill="#111"/>
          <!-- ZÃ¤hne -->
          <polygon points="115,190 125,210 135,190" fill="#fff"/>
          <polygon points="145,190 155,210 165,190" fill="#fff"/>
          <polygon points="175,190 185,210 195,190" fill="#fff"/>
          <!-- FÃ¼ÃŸe -->
          <ellipse cx="110" cy="260" rx="26" ry="10" fill="#6a52ff"/>
          <ellipse cx="190" cy="260" rx="26" ry="10" fill="#6a52ff"/>
        </g>
      </svg>
      <div class="tag">Fast! Versuch's nochmal ğŸ‘»</div>
      <div class="overlay-card">
        <div class="overlay-card__label">Das war:</div>
        <div id="correctLetter" class="overlay-letter">A</div>
      </div>
      <div class="overlay-hint">ğŸ‘† Tippe zum Weitermachen</div>
    </div>
  </div>

  <!-- Ergebnis-Modal -->
  <div id="modal" class="modal hidden" aria-modal="true" role="dialog">
    <div class="dialog">
      <div class="trophy-animation" id="trophyAnimation" aria-hidden="true"></div>
      <h3 id="resultTitle">Toll gemacht!</h3>
      <p class="result-line"><span id="resultText">8 von 10 richtig</span></p>
      <div class="controls" style="justify-content:center; margin-top:10px">
        <button id="again" class="btn">Nochmal spielen</button>
        <button id="closeModal" class="btn secondary">SchlieÃŸen</button>
      </div>
    </div>
  </div>

  <div id="modeDialog" class="modal hidden mode-dialog" role="dialog" aria-modal="true" aria-labelledby="modeDialogTitle">
    <div class="dialog">
      <h3 id="modeDialogTitle">Wie mÃ¶chtest du spielen?</h3>
      <p class="muted" style="margin:0 0 12px">Tippe eine Karte, dann geht es los!</p>
      <div class="mode-dialog-cards" role="group" aria-label="Moduswahl">
        <button type="button" class="mode-dialog-card" data-mode-option data-mode="LERNWEG">
          <strong>ğŸ¦‹ Lernweg</strong>
          <span>GefÃ¼hrter Pfad mit Belohnungen</span>
        </button>
        <button type="button" class="mode-dialog-card" data-mode-option data-mode="FREI">
          <strong>ğŸ¨ Individuelles Spiel</strong>
          <span>Stelle dein eigenes Spiel zusammen</span>
        </button>
      </div>
      <div class="mode-dialog-actions">
        <button id="modeDialogCancel" class="btn secondary" type="button">ZurÃ¼ck</button>
        <button id="modeDialogStart" class="btn" type="button" disabled>Los geht's!</button>
      </div>
      <div id="individualPanel" class="individual-panel hidden">
        <p class="muted" style="margin-top:0">Stelle dein Spiel selbst zusammen.</p>
        <span class="panel-label">Buchstaben-Anzahl</span>
        <div class="chip-group" id="freeCountGroup" role="group" aria-label="Anzahl Buchstaben">
          <button type="button" class="chip" data-free-count="4">4 Buchstaben</button>
          <button type="button" class="chip" data-free-count="8">8 Buchstaben</button>
          <button type="button" class="chip" data-free-count="12">12 Buchstaben</button>
          <button type="button" class="chip" data-free-count="26">Alle 26</button>
        </div>
        <span class="panel-label">Audio-Schwierigkeit</span>
        <div class="chip-group" id="difficultyGroup" role="group" aria-label="Schwierigkeit auswÃ¤hlen">
            <button type="button" class="chip" data-difficulty="LEICHT">ğŸ˜Š Leicht</button>
            <button type="button" class="chip" data-difficulty="MITTEL">ğŸ˜ Mittel</button>
            <button type="button" class="chip" data-difficulty="SCHWER">ğŸ˜¬ Schwer</button>
            <button type="button" class="chip" data-difficulty="AFFIG">ğŸ¤ª Affig</button>
        </div>
      </div>
    </div>
  </div>

  <div id="parentalGate" class="modal hidden" role="dialog" aria-modal="true">
    <div class="dialog">
      <h3>Bitte bestÃ¤tigen</h3>
      <p class="muted">Um fortzufahren, beantworten Sie bitte diese Frage:</p>
      <p id="gateQuestion" style="font-size: 20px; font-weight: bold; margin: 16px 0;"></p>
      <input type="number" id="gateAnswer" style="padding: 12px; font-size: 18px; text-align: center; border-radius: 12px; border: 2px solid #ddd; width: 100px;">
      <div class="controls" style="justify-content:center; margin-top:20px">
          <button id="gateCancel" class="btn secondary">Abbrechen</button>
          <button id="gateSubmit" class="btn">BestÃ¤tigen</button>
      </div>
    </div>
  </div>

  <footer>
    <p>Made for kids ğŸ’œ Â· Alle Daten bleiben auf diesem GerÃ¤t. | <span class="muted">Bei iOS/Safari evtl. â€Mikrofon erlaubenâ€œ bestÃ¤tigen.</span></p>
  </footer>

      <script type="module" src="app/main.js"></script>

</body>
</html>
